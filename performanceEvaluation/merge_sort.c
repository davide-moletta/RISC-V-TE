#include <stdio.h>
#include "user_code.h"

/*
    NORMAL RUN:
        - Binary size: 5344 Byte
        - Execution time: 1.21690034866333s

    SECURE RUN:
        - Binary size: 5600 Byte
        - Execution time: 1.21708083152771s
        - Instrumentation time: 0.0035352706909179688s
        - Simulation time: 0s (no indirect jumps)
        - CFG extraction time: 0.0017805099487304688s
*/

void merge(int arr[], int left, int mid, int right)
{
    int i, j, k;
    int n1 = mid - left + 1;
    int n2 = right - mid;

    int L[n1], R[n2];

    for (i = 0; i < n1; i++)
        L[i] = arr[left + i];
    for (j = 0; j < n2; j++)
        R[j] = arr[mid + 1 + j];

    i = 0;
    j = 0;
    k = left;
    while (i < n1 && j < n2)
    {
        if (L[i] <= R[j])
        {
            arr[k] = L[i];
            i++;
        }
        else
        {
            arr[k] = R[j];
            j++;
        }
        k++;
    }

    while (i < n1)
    {
        arr[k] = L[i];
        i++;
        k++;
    }

    while (j < n2)
    {
        arr[k] = R[j];
        j++;
        k++;
    }
}

void mergeSort(int arr[], int left, int right)
{
    printf("Checking: %d - %d\n", left, right);
    if (left < right)
    {
        int mid = left + (right - left) / 2;

        mergeSort(arr, left, mid);
        mergeSort(arr, mid + 1, right);

        merge(arr, left, mid, right);
    }
}

void start_u_code()
{
    int arr[] = {3779, 465, 4958, 7556, 7396, 9569, 912, 6833, 8570, 3826, 5688, 6434, 7096, 152,
                 8157, 7648, 2900, 1746, 2961, 5450, 8150, 7863, 3994, 8677, 2207, 2014, 8748, 3862,
                 8961, 9135, 6319, 3770, 1851, 5498, 1022, 4163, 2780, 1450, 1619, 2865, 9197, 3271,
                 6703, 4193, 3907, 8092, 7310, 8067, 7657, 7744, 6435, 6836, 5498, 4881, 1493, 6482,
                 5231, 3820, 4541, 4338, 6178, 3569, 1562, 6555, 7567, 71, 6229, 8381, 1287, 1595,
                 4413, 1273, 2459, 2331, 4214, 4906, 389, 2054, 798, 2499, 7373, 6931, 5381, 6336,
                 1540, 3878, 6398, 7145, 1677, 6749, 2192, 116, 3629, 1372, 3814, 4303, 3961, 3195,
                 2536, 1382, 850, 2281, 1504, 5445, 5716, 606, 1988, 846, 7743, 6077, 6979, 8673, 2855,
                 8563, 8408, 5162, 6468, 4210, 7007, 9207, 7476, 9895, 6031, 4747, 493, 8942, 1992, 2060,
                 2860, 7017, 747, 3307, 5717, 5531, 6251, 922, 7453, 6880, 3783, 3106, 9919, 955, 5096,
                 6396, 154, 1679, 1348, 7448, 7876, 5181, 82, 1060, 4155, 5369, 5473, 2116, 988, 8859,
                 6601, 7269, 8958, 4326, 5497, 1569, 5676, 9230, 1670, 9804, 8502, 4775, 2021, 8919,
                 536, 3864, 2941, 8406, 6615, 9568, 1058, 8896, 4064, 6953, 8731, 2886, 2269, 8441,
                 143, 3104, 8443, 1511, 5723, 9023, 1573, 9212, 7272, 4058, 3298, 3389, 8220, 1635,
                 8569, 7379, 7277, 5997, 1880, 714, 8112, 3886, 3977, 3745, 9205, 3633, 8608, 4009,
                 2668, 3955, 1418, 4322, 9622, 6229, 5485, 352, 1521, 131, 4852, 1317, 4915, 424, 8059,
                 3505, 6688, 3729, 1193, 6046, 8051, 3663, 7601, 4879, 9224, 3623, 5329, 1269, 3887};
    int arr_size = sizeof(arr) / sizeof(arr[0]);

    printf("Start array: ");
    for (int i = 0; i < arr_size; i++)
    {
        printf("%d - ", arr[i]);
    }
    printf("\n");

    mergeSort(arr, 0, arr_size - 1);

    printf("End array: ");
    for (int i = 0; i < arr_size; i++)
    {
        printf("%d - ", arr[i]);
    }
    printf("\n");
}
